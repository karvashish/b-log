<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>{{.Title}}</title>
	<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
	<script src="https://unpkg.com/htmx.org@1.9.10"></script>
	<link rel="stylesheet" href="/static/styles.css">
</head>
<body>
	<header>
		<a href="/" style="color:inherit; text-decoration:none;">b-log</a>
	</header>
	<main>{{.Content}}</main>
	<script>
		(function () {
			function init() {
				const wrapper  = document.querySelector('.slider-wrapper');
				const track    = document.querySelector('.posts-container');
				const leftBtn  = document.getElementById('slide-left');
				const rightBtn = document.getElementById('slide-right');
				if (!wrapper || !track || !leftBtn || !rightBtn) return;

				const items = Array.from(track.querySelectorAll('.post-link'));
				const gap   = parseFloat(getComputedStyle(track).gap) || 0;
				const cardW = items[0] ? items[0].getBoundingClientRect().width : 0;
				const wrapperW = wrapper.getBoundingClientRect().width;
				const start = (wrapperW - cardW - 28) / 2;

				if (items.length <= 1) {
					leftBtn.onclick = rightBtn.onclick = null;
					if (items[0]) {
						items[0].classList.add('active');
						track.style.transform = `translateX(${start}px)`;
					}
					return;
				}

				const step = cardW + gap;
				const offsets = items.map((_, i) => start - i * step);
				track.style.width = (step * items.length) + 'px';

				let idx = 0;

				function apply() {
					track.style.transform = `translateX(${offsets[idx]}px)`;
					items.forEach(el => el.classList.remove('active'));
					items[idx].classList.add('active');
				}
				apply();

				leftBtn.onclick  = () => { if (idx > 0) { idx--; apply(); } };
				rightBtn.onclick = () => { if (idx < items.length - 1) { idx++; apply(); } };
			}

			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', init);
			} else {
				init();
			}
			document.addEventListener('htmx:afterOnLoad', init);
		})();
	</script>
</body>
</html>
